{% load static  %}
<!DOCTYPE html>
<html>

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- PAGE settings -->
  <link rel="icon" href="{% static 'icons/favicon.ico' %}">
  <title>Bee Project</title>
  <meta name="description" content="Wireframe design of an album page by Pingendo">
  <meta name="keywords" content="Pingendo bootstrap example template wireframe album ">
  <meta name="author" content="Pingendo">
  <!-- CSS dependencies -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" type="text/css">
  <link rel="stylesheet" href="{% static 'style/wireframe.css' %}">

<script lang="javascript" src="{% static 'js/xlsx.full.min.js' %}"></script>
<script lang="javascript" src="{% static 'js/FileSaver.min.js' %}"></script>
<script lang="javascript" src="{% static 'js/slim_notifier.js' %}"></script>
</head>

<body class="bg-warning">
   <nav class="navbar navbar-expand-lg navbar-dark bg-dark" style="">
    <div class="container">
      <div class="row">
        <div class="col-md-12"><img class="img-fluid d-block" src="{% static 'icons/bee.png' %}" style=""></div>
      </div>
      <div class="row">
        <div class="col-md-12">
          <h1 class="">&nbsp;Bee&nbsp;Project</h1>
        </div>
      </div> <button class="navbar-toggler navbar-toggler-right border-0" type="button" data-toggle="collapse" data-target="#navbar11">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbar11">
        <ul class="navbar-nav ml-auto">
          <li class="nav-item"> <a class="nav-link" href="/bee_project/" >Home</a> </li>
          <li class="nav-item"> <a class="nav-link" href="/instructions/">Instructions</a> </li>
          <li class="nav-item"> <a class="nav-link" href="/descargar/">Descargar</a> </li>
          <li class="nav-item"> <a class="nav-link" href="/about_us/">About us</a> </li>
          <li class="nav-item"><a class="btn navbar-btn ml-md-2 btn-secondary" href="/accounts/logout/">Log out</a></li>
        </ul>
      </div>
    </div>
  </nav>
  <div class="py-3">
    <div class="container">
      <div class="row">
        <div class="col-md-12">
          <h2 class="">Descargar la base de datos en excel&nbsp;</h2>
        </div>
      </div>
    </div>
  </div>
  <div class="py-0" style="">
    <div class="container">
      <div class="row">
        <div class="col-md-12">
          <div class="table-responsive">
            <table class="table table-bordered ">
              <thead class="thead-dark">
                <tr>
                  <th class="text-center">Fecha</th>
                  <th class="text-center">Accion</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td class="text-center">
                    <div class="row">
                      <div class="col-md-12">Desde: <input type="date" id="fecha1" name="fecha2"   min="2021-01-01" max="2099-12-31"></div>
                    </div>
                    <div class="row">
                      <div class="col-md-12 mt-2">Hasta : <input type="date" id="fecha2" name="fecha2"   min="2021-01-01" max="2099-12-31"></div>
                    </div>
                  </td>
                 <td class="text-center"><button id="button-a"class="btn btn-primary"><i class="fa fa-download fa-fw"></i>&nbsp;Descargar&nbsp;</button></td>
                </tr>
           
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="bg-warning py-2 w-100 h-50" style=""></div>
  <div class="py-3 bg-dark" style="">
    <div class="container">
      <div class="row">
        <div class="col-md-12 text-center">
          <p class="mb-0">Â© 2020-2021 Bee Project . All rights reserved</p>
        </div>
      </div>
    </div>
  </div>
   <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>



<script>

$("#button-a").click(function(){

    var fecha1 = document.getElementById("fecha1").value;
    var fecha2 = document.getElementById("fecha2").value;
    // console.log(fecha1);
    // console.log(fecha2);

if (fecha1.length == 0) {


        SlimNotifierJs.notification('error', 'Error', 'Fecha inicial no definida', 3000);


}
else if (fecha2.length == 0) {

   SlimNotifierJs.notification('error', 'Error', 'Fecha Final no definida', 3000);
}


else if (Date.parse(fecha2) < Date.parse(fecha1))  {

   SlimNotifierJs.notification('error', 'Error', 'Fecha Final es menor a la inicial', 3000);
}

else{


    const url = "http://beeproject2021.pythonanywhere.com/web/descargar/";

    // post body data 
    const params = {"fecha1":fecha1,"fecha2":fecha2};

    // request options
    const options = {
    method: 'POST',
    body: JSON.stringify(params),
    headers: {
    'Content-Type': 'application/json',
    "Authorization": "token c964678467cd53d0d79ca131f3463bba776d17d8"
    }
    }

    // send POST request
    fetch(url, options)
    .then(res => res.json())
    // .then(res => console.log(res))
    .then(function(data){
    // let myresults = data.headers
    // console.log(data);
    var wb = XLSX.utils.book_new();
    wb.Props = {
    Title: "Beeproject",
    Subject: "donwload_data",
    Author: "unknow",
    CreatedDate: new Date(2021,6,30)
    };

    wb.SheetNames.push("Pagina_1");
    var ws_data = data;
    var ws = XLSX.utils.aoa_to_sheet(ws_data);
    wb.Sheets["Pagina_1"] = ws;

    var wbout = XLSX.write(wb, {bookType:'xlsx',  type: 'binary'});




    function s2ab(s) {

    var buf = new ArrayBuffer(s.length);
    var view = new Uint8Array(buf);
    for (var i=0; i<s.length; i++) view[i] = s.charCodeAt(i) & 0xFF;
    return buf;

    }



    saveAs(new Blob([s2ab(wbout)],{type:"application/octet-stream"}), 'Reporte.xlsx');
    });



  }  });

</script>
</body>

</html>